--lab 4 ex 1-25

--2. S? se afi?eze cel mai mare salariu, cel mai mic salariu, suma ?i media salariilor
--tuturor angaja?ilor. Eticheta?i coloanele Maxim, Minim, Suma, respectiv Media. Sa se
--rotunjeasca rezultatele.

select min(salary) as "MINIM",
MAX(salary) as "MAXIM",
SUM(salary) as "Sum",
AVG(salary) as "Medie"
--concat(concat(concat(first_name,' '),' '),last_name) as "nume intreg"
from employees
group by salary;

--3. S? se afi?eze minimul, maximul, suma ?i media salariilor pentru fiecare job. 

select min(salary) as "MINIM",
MAX(salary) as "MAXIM",
SUM(salary) as "Sum",
AVG(salary) as "Medie",
job_id as "JOB"
--concat(concat(concat(first_name,' '),' '),last_name) as "nume intreg"
from employees
group by job_id
ORDER BY JOB_ID;

select *
from employees
where LOWER(job_id)='ad_vp';


--4. S? se afi?eze num?rul de angaja?i pentru fiecare job.

select count(employee_id) as "Nr de angajati" , job_id as "Job"
from employees
group by job_id
order by job_id;



--5. S? se determine num?rul de angaja?i care sunt ?efi. Etichetati coloana �Nr. manageri�. 
--varianta cu where
select count(employee_id) as "Nr manageri"
from employees
where NVL(manager_id,0)=0;

SELECT first_name from employees
where employee_id = (select employee_id from employees
                    where nvl(MANAGER_ID,0)=0);
                    
--variants cu having
Select count(employee_id) as "Nr manageri"
from employees
GROUP BY manager_id
HAVING NVL(manager_id,0)=0;



--6. S? se afi?eze diferen?a dintre cel mai mare si cel mai mic salariu. Etichetati coloana. 
--in toti angajatii
select max(salary)-min(salary) as "diferenta"
from employees;


--pt fiecare job in parte
select max(salary)-min(salary) as "diferenta",
job_id as "Job"
from employees
group by job_id;


--7. Scrie?i o cerere pentru a se afi?a numele departamentului, loca?ia, num?rul de
--angaja?i ?i salariul mediu pentru angaja?ii din acel departament. Coloanele vor fi
--etichetate corespunz?tor.


select d.department_name as "departament",
l.street_address || ' '|| l.city as "adresa",
count(employee_id) as "nr angajati",
round(AVG(e.salary),3) as "Salariu mediu"
from departments d
join locations l
ON d.location_id=l.location_id
join employees e
ON d.department_id=e.department_id
--pui in group by toate coloanele din select (care au sens)
GROUP BY d.department_name,l.street_address || ' '|| l.city;


select salary
from employees e
join departments d
on d.department_id=e.department_id
where d.department_name='Accounting';


--8. S? se afi?eze codul ?i numele angaja?ilor care c�stiga mai mult dec�t salariul mediu
--din firm?. Se va sorta rezultatul �n ordine descresc?toare a salariilor. 


--join sau left join pentru ca  ma intereseaza cazul in care department_id este null
--problema care salariul din firma,adica job_id
select 
    employee_id as "Cod angajat",
    first_name || ' ' || last_name as "Nume angajat",
    e.salary as "salariu"
    --e.department_id,
    --e.job_id
FROM 
    employees e
JOIN        
    jobs j
ON 
    e.job_id=j.job_id
where
    e.salary>(j.min_salary+j.max_salary)/2
GROUP BY
    employee_id,first_name || ' ' || last_name,e.salary
ORDER BY
    salary;
    
    
--9. Pentru fiecare ?ef, s? se afi?eze codul s?u ?i salariul celui mai prost platit
--subordonat. Se vor exclude cei pentru care codul managerului nu este cunoscut. De
--asemenea, se vor exclude grupurile �n care salariul minim este mai mic de 1000$.
--Sorta?i rezultatul �n ordine descresc?toare a salariilor. 


SELECT 
    min(salary),
    min(manager_id)
FROM
    employees e
WHERE
    manager_id=(
            SELECT employee_id
            FROM 
                employees
            WHERE
                NVL(manager_id,0)=0
             
            GROUP BY
                employee_id);
    
    


--10. Pentru departamentele in care salariul maxim dep??e?te 3000$, s? se ob?in? codul,
--numele acestor departamente ?i salariul maxim pe departament. 


SELECT 
    d.department_id as "Departament",
    d.department_name as "Nume dep",
    max(e.salary) as "Salariu max pe dep",
    count(employee_id)
    
FROM
    employees e
JOIN
    jobs j
ON 
    e.job_id=j.job_id
JOIN 
    departments d
ON 
    e.department_id=d.department_id
WHERE
    j.max_salary>3000
GROUP BY d.department_id,d.department_name,j.max_salary;


select *
from employees
where department_id=90;


--11. Care este salariul mediu minim al job-urilor existente? Salariul mediu al unui job va fi
--considerat drept media arirmetic? a salariilor celor care �l practic?.

select  
    j.job_title,
    (sum(e.salary)/count(e.employee_id)) as "mediu/job"
from
    employees e
join 
    jobs j
ON
    e.job_id=j.job_id
GROUP BY
    j.job_title
ORDER BY
    J.JOB_TITLE;
    
    
--minimul din toate
select  
   -- j.job_title,
   min( (sum(e.salary)/count(e.employee_id))) as "mediu/job"
from
    employees e
join 
    jobs j
ON
    e.job_id=j.job_id
GROUP BY
    j.job_title
ORDER BY
    J.JOB_TITLE;
    
    
    
--12. S? se afi?eze codul, numele departamentului ?i suma salariilor pe departamente. 

SELECT
    d.department_id,d.department_name,sum(e.salary) as "suma salarii"
FROM 
    DEPARTMENTS d
JOIN
    EMPLOYEES e
ON 
    d.department_id=e.department_id
GROUP BY
    d.department_id,d.department_name;
    
    
--13. S? se afi?eze maximul salariilor medii pe departamente. 
--cum adica maximul salariilor medii wtf?
SELECT
    d.department_id,d.department_name,round(sum(e.salary)/count(e.employee_id),3)  as "suma salarii"
FROM 
    DEPARTMENTS d
JOIN
    EMPLOYEES e
ON 
    d.department_id=e.department_id
GROUP BY
    d.department_id,d.department_name;
    
    
--14. S? se obtina codul, titlul ?i salariul mediu al job-ului pentru care salariul mediu este
 --minim.
 --?????????????
 
 select *
 from jobs j1
 join (
 select j.job_id,sum(e.salary)/count(e.salary) as "mediu"
         from jobs j
         join employees e
         on j.job_id=e.job_id
         group by j.job_id) ON j1.min_salary=sum(e.salary)/count(e.salary) ;
         
         
         
--15
--clauza having este folosita pt a filtra grupuri ,de aceea este
--insotita de group by(care formeaza grupuri).Daca lipseste group by
--having considera tot ce intoarce selectul drept un singur grup 
--si il filtreaza dupa conditie.
select 
    round(avg(salary),3) as "Salariu mediu firma"
from 
    employees
having
     avg(salary)>2500;


--16

select 
    sum(salary) as "Suma salarii pe dep,artamente",
    e.department_id as "Departament",
    salariu."a"
    
from 
    employees e
join    
            (select sum(sal.salary) as "a" ,
            sal.job_id 
            from employees sal
            group by sal.job_id) salariu
ON e.job_id=salariu.job_id
where 
    department_id is not null
group by
    e.department_id
order by
    e.department_id;
